<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>formula</title>
    <script src="https://unpkg.com/mqtt@2.17.0/dist/mqtt.min.js"></script>
    <script>
        var mqtt_server = 'localhost';
        var mqtt_port = 3001;
        var testConnUrl = 'http://localhost:3001/';

        // Comprobar que el servidor está corriendo y si está corriendo conectarse al
        // websocket de mqqt que trae los datos.y
        var req = new XMLHttpRequest();
        req.open('GET', testConnUrl, true);
        req.setRequestHeader('Access-Control-Allow-Origin', '*');
        req.onreadystatechange = function (aEvt) {
          if (req.readyState == 4) {
            if (req.status == 200) {
              openMqttConnection();
            } else {
              console.error("Error conectando al servidor...");
            }
          }
        };
        req.send(null);

        // Abre la conexión al web socket de mqtt que trae los datos en tiempo real.
        function openMqttConnection() {
          var mqttService = mqtt.connect("ws://" + mqtt_server, {
            //username: mqtt_username,
            //password: mqtt_password,
            //clientId: "interface",
            port: mqtt_port
          });

          mqttService.subscribe("formula/realtime-data");
          mqttService.subscribe("formula/realtime-fake-data");
          mqttService.publish("formula/realtime-data", JSON.stringify({
            probando: 'a publicar algo...'
          }));

          // Escuchando los datos en tiempo real.
          mqttService.on("message", (topic, payload) => {
            console.info([topic, payload].join(": "));
          });
        }
    </script>
  </head>
  <body>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
